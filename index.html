<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Push Notification</title>
</head>

<body>
    <h1>Web Push Notification</h1>
    <script type="module" src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/7.18.0/firebase-messaging.js"></script>

    <script>

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDRVMFWfoV5vgEI82Qy0jbIOT-q9ZyTWTQ",
            authDomain: "csp-fcm.firebaseapp.com",
            projectId: "csp-fcm",
            storageBucket: "csp-fcm.appspot.com",
            messagingSenderId: "1063903322339",
            appId: "1:1063903322339:web:72f81dfb12fbb4c991a5d6"
        };

        var app = firebase.initializeApp(firebaseConfig);

        const messaging = firebase.messaging();

        messaging.onMessage((payload) => {
            console.log('Message received. ', payload);
        })

        function RequestPermission() {
            console.log('Requesting permission...');
            Notification.requestPermission().then((permission) => {
                if (permission === 'granted') {
                    console.log('Notification permission granted.');
                    // TODO(developer): Retrieve a registration token for use with FCM.
                    // In many cases once an app has been granted notification permission,
                    // it should update its UI reflecting this.
                    getStartToken();
                } else {
                    console.log('Unable to get permission to notify.');
                }
            });
        }

        function getStartToken() {
            messaging.getToken({ "vapidKey": "BG9ff0wgZhb8StMVABPrsW55rzYQoY1xZYfpkO5VvWS3EnKlYwcjnJAVbaVHQReWrVPi2zFOLGf242ad8sq9MBk" })
                .then((currentToken) => {
                    if (currentToken) {
                        //sendTokenToServer(currentToken);
                        console.log("generated token=>", currentToken)
                    }
                    else {
                        // Show permission request.
                        RequestPermission();
                        //setTokenSentToServer(false);
                    }
                }).catch((err) => {
                    console.error("getStartToken error=>", err)
                    //setTokenSentToServer(false);
                });
        }

        getStartToken();
    </script>

</body>

</html>